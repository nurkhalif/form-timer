<script>
async function saveSettings() {
  const settings = {
    form: document.getElementById("formLink").value.trim(),
    minutes: parseInt(document.getElementById("minutes").value, 10),
    name: document.getElementById("quizName").value.trim()
  };

  const content = btoa(JSON.stringify(settings, null, 2));

  const repo = "nurkhalif/form-timer";
  const filePath = "settings.json";
  const token = "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"; // ⚠️ Remove trailing space

  let sha = undefined;

  try {
    const res = await fetch(`https://api.github.com/repos/${repo}/contents/${filePath}`, {
      headers: { "Authorization": `token ${token}` }
    });
    if (res.ok) {
      const fileData = await res.json();
      sha = fileData.sha;
    }
  } catch (e) {
    console.log("File does not exist yet, will create new one.");
  }

  const updateRes = await fetch(`https://api.github.com/repos/${repo}/contents/${filePath}`, {
    method: "PUT",
    headers: {
      "Authorization": `token ${token}`,
      "Content-Type": "application/json"
    },
    body: JSON.stringify({
      message: "Update quiz settings",
      content,
      sha
    })
  });

  if (updateRes.ok) {
    document.getElementById("status").innerText = "✅ Settings saved to GitHub!";
  } else {
    const err = await updateRes.json();
    document.getElementById("status").innerText = `❌ Error: ${err.message}`;
  }
}
</script>
